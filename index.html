<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Call Center & Delivery Dashboard by Branch</title>
<style>
body { font-family: Arial, sans-serif; margin: 20px; background: #f5f5f5; }
h1, h2 { text-align: center; }
table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
th { background-color: #007BFF; color: white; }
.green { background-color: #c6f6c6; }
.yellow { background-color: #fff3c6; }
.red { background-color: #f6c6c6; }
.dashboard { display: flex; justify-content: space-around; flex-wrap: wrap; margin-bottom: 20px; }
.card { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); width: 18%; text-align: center; margin-bottom: 10px; }
.card h2 { margin: 10px 0; color: #007BFF; }
.form-container { background: white; padding: 15px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); margin-bottom: 20px; }
input, select { padding: 5px; margin: 5px; }
button { padding: 7px 12px; margin: 5px; background-color: #007BFF; color: white; border: none; border-radius: 4px; cursor: pointer; }
button:hover { background-color: #0056b3; }
.editBtn { background-color: #ffa500; }
.deleteBtn { background-color: #ff4d4d; }
.branch-section { background: #fff; padding: 10px; margin-bottom: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
</style>
</head>
<body>

<h1>Call Center & Delivery Dashboard by Branch</h1>

<!-- Dashboard -->
<div class="dashboard">
  <div class="card"><h3>Total Orders (CC)</h3><h2 id="totalOrdersCC">0</h2></div>
  <div class="card"><h3>Total Picked Up</h3><h2 id="totalPickedUp">0</h2></div>
  <div class="card"><h3>Total Orders Delivered</h3><h2 id="totalDelivered">0</h2></div>
  <div class="card"><h3>Delivery Success %</h3><h2 id="deliveryRate">0%</h2></div>
  <div class="card"><h3>Total Difference</h3><h2 id="totalDifference">0</h2></div>
</div>

<!-- Data Input Form -->
<div class="form-container">
<h3>Add New Entry</h3>
<label>Date: <input type="date" id="entryDate"></label>
<label>Branch: 
  <select id="branchSelect">
    <option>Hamdan St</option>
    <option>Al Khalidiyah</option>
    <option>Shabiya 11</option>
    <option>Muroor</option>
    <option>Al Majaz</option>
    <option>Al Barsha</option>
    <option>Al Satwa</option>
    <option>Al Rigga</option>
  </select>
</label>
<label>Orders Received (CC): <input type="number" id="ordersReceived" min="0"></label>
<label>Picked Up (CC): <input type="number" id="pickedUp" min="0"></label>
<label>Cancelled (CC): <input type="number" id="cancelledCC" min="0"></label>
<label>Orders Delivered (DL): <input type="number" id="ordersDelivered" min="0"></label>
<button onclick="addRow()">Add Entry</button>
<button onclick="printReport()">Print Report</button>
</div>

<!-- Filter -->
<div class="form-container">
<h3>Filter Table</h3>
<label>Filter by Branch:
  <select id="filterBranch" onchange="applyFilter()">
    <option value="">All</option>
    <option>Hamdan St</option>
    <option>Al Khalidiyah</option>
    <option>Shabiya 11</option>
    <option>Muroor</option>
    <option>Al Majaz</option>
    <option>Al Barsha</option>
    <option>Al Satwa</option>
    <option>Al Rigga</option>
  </select>
</label>
<label>Filter by Date: <input type="date" id="filterDate" onchange="applyFilter()"></label>
</div>

<!-- Branch Sections -->
<div id="branchTables"></div>

<script>
let branchTables = document.getElementById('branchTables');

// Load data from LocalStorage
let data = JSON.parse(localStorage.getItem('ccData')) || [];

function saveData() {
  localStorage.setItem('ccData', JSON.stringify(data));
  updateDashboard();
  renderBranchTables();
}

function addRow() {
  const entry = {
    date: document.getElementById('entryDate').value,
    branch: document.getElementById('branchSelect').value,
    ordersReceived: parseInt(document.getElementById('ordersReceived').value) || 0,
    pickedUp: parseInt(document.getElementById('pickedUp').value) || 0,
    cancelledCC: parseInt(document.getElementById('cancelledCC').value) || 0,
    delivered: parseInt(document.getElementById('ordersDelivered').value) || 0
  };
  entry.difference = entry.delivered - (entry.ordersReceived - entry.pickedUp - entry.cancelledCC);
  data.push(entry);
  saveData();
  clearInputs();
}

function clearInputs() {
  document.getElementById('ordersReceived').value = '';
  document.getElementById('pickedUp').value = '';
  document.getElementById('cancelledCC').value = '';
  document.getElementById('ordersDelivered').value = '';
  document.getElementById('entryDate').value = '';
}

// Dashboard update
function updateDashboard(){
  let totalCC=0,totalPicked=0,totalDelivered=0,totalDiff=0;
  data.forEach(entry=>{
    totalCC+=entry.ordersReceived;
    totalPicked+=entry.pickedUp;
    totalDelivered+=entry.delivered;
    totalDiff+=entry.difference;
  });
  document.getElementById('totalOrdersCC').innerText=totalCC;
  document.getElementById('totalPickedUp').innerText=totalPicked;
  document.getElementById('totalDelivered').innerText=totalDelivered;
  document.getElementById('totalDifference').innerText=totalDiff;
  const deliveryRate=totalCC>0 ? Math.round((totalDelivered/totalCC)*100) : 0;
  const rateElem=document.getElementById('deliveryRate');
  rateElem.innerText=deliveryRate+'%';
  rateElem.className=deliveryRate>=90?'green':(deliveryRate>=80?'yellow':'red');
}

// Render branch tables
function renderBranchTables(){
  branchTables.innerHTML='';
  const branches=[...new Set(data.map(d=>d.branch))];
  branches.forEach(branch=>{
    const branchData=data.filter(d=>d.branch===branch);
    const section=document.createElement('div');
    section.className='branch-section';
    section.innerHTML=`<h2>${branch}</h2>
      <table>
        <thead>
          <tr>
            <th>Date</th>
            <th>Orders Received (CC)</th>
            <th>Picked Up (CC)</th>
            <th>Cancelled (CC)</th>
            <th>Orders Delivered (DL)</th>
            <th>Difference</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody>
        ${branchData.map((entry,index)=>`<tr>
          <td>${entry.date}</td>
          <td>${entry.ordersReceived}</td>
          <td>${entry.pickedUp}</td>
          <td>${entry.cancelledCC}</td>
          <td>${entry.delivered}</td>
          <td class="${entry.difference===0?'green':Math.abs(entry.difference)<=2?'yellow':'red'}">${entry.difference}</td>
          <td>
            <button class="editBtn" onclick="editRow(${data.indexOf(entry)})">Edit</button>
            <button class="deleteBtn" onclick="deleteRow(${data.indexOf(entry)})">Delete</button>
          </td>
        </tr>`).join('')}
        </tbody>
      </table>`;
    branchTables.appendChild(section);
  });
}

// Edit/Delete
function editRow(index){
  const entry=data[index];
  document.getElementById('entryDate').value=entry.date;
  document.getElementById('branchSelect').value=entry.branch;
  document.getElementById('ordersReceived').value=entry.ordersReceived;
  document.getElementById('pickedUp').value=entry.pickedUp;
  document.getElementById('cancelledCC').value=entry.cancelledCC;
  document.getElementById('ordersDelivered').value=entry.delivered;
  data.splice(index,1);
  saveData();
}

function deleteRow(index){
  if(confirm("Are you sure you want to delete this entry?")){
    data.splice(index,1);
    saveData();
  }
}

// Filter
function applyFilter(){
  const branchFilter=document.getElementById('filterBranch').value;
  const dateFilter=document.getElementById('filterDate').value;
  branchTables.querySelectorAll('.branch-section').forEach(section=>{
    const branchName=section.querySelector('h2').innerText;
    const matchBranch=(branchFilter==='') || (branchName===branchFilter);
    let showSection=false;
    section.querySelectorAll('tbody tr').forEach(row=>{
      const date=row.cells[0].innerText;
      const matchDate=(dateFilter==='')||(date===dateFilter);
      row.style.display=(matchBranch && matchDate)?'':'none';
      if(row.style.display!=='none') showSection=true;
    });
    section.style.display=showSection? 'block':'none';
  });
}

// Print
function printReport(){ window.print(); }

// Initialize
updateDashboard();
renderBranchTables();
</script>

</body>
</html>
